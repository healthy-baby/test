(function(){function r(a,c,d){"function"!==typeof c&&(c=function(){});if("Array"===a.constructor.name)for(var b=0,f=0,h=a.length;f<h;f++)r(a[f],function(){b++;b===a.length&&c()},d);else{"js"!==d&&"css"!==d&&(d=a.toLowerCase().split("?")[0].split("#")[0].split(".").pop());"js"!==d&&"css"!==d&&(console.error('Undefined type of static file "'+a+'"'),c());if("js"===d){var g=document.createElement("script");g.type="text/javascript"}else g=document.createElement("link"),g.type="text/css",g.rel="stylesheet";
g.readyState?g.onreadystatechange=function(){if("loaded"===g.readyState||"complete"===g.readyState)g.onreadystatechange=null,c()}:g.onload=function(){c()};"js"===d?g.src=a:g.href=a;document.getElementsByTagName("head")[0].appendChild(g)}}function u(a,c,d){d=d||{};d.path=d.path||"/";var b=d.expires;if(b){if("number"==typeof b){var f=new Date;f.setTime(f.getTime()+1E3*b);b=d.expires=f}b.toUTCString&&(d.expires=b.toUTCString())}c=encodeURIComponent(c);a=a+"="+c;for(var h in d)a+="; "+h,c=d[h],!0!==c&&
(a+="="+c);document.cookie=a}function v(a){return(a=document.cookie.match(new RegExp("(?:^|; )"+a.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)")))?decodeURIComponent(a[1]):void 0}function x(a){return/^([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/.test(a)}function y(a,c){var b=Math.pow(10,c||0);return Math.round(a*b)/b}function z(b){if("/cart"!==window.location.pathname)a.init(b,!1);else{"undefined"===typeof window.Spurit.selectorPickerConfig&&
(window.Spurit.selectorPickerConfig={});window.Spurit.selectorPickerConfig.demoStaticHtml='<div style="display:inline-block;margin:10px 10px;background:#dff0d8;color:#333;border:1px solid #333;padding:10px;font-size:16px;font-weight:normal">[demo-text]</div>';var c=function(c){-1===document.location.search.indexOf(w.cmd)&&c.length?a.init(b,!0):-1!==document.location.search.indexOf(w.cmd)&&(c.length?r(w.url,function(){}):(c=window.location.href.match(/vid=(\d+)&/)[1],b.ajax("/cart/add.js",{type:"post",
data:{quantity:1,id:c},complete:function(){window.location.href=window.location.href}})))};Spurit.global.onReady(["cart","checkout","prices"],function(){p=Spurit.global.cartPool.getAdapter(t);c(p.getItems())},{checkout:{hash:SSPParams.id,app_id:SSPParams.app,app_name:t}})}}function A(){"undefined"===typeof jQuery?r("//ajax.googleapis.com/ajax/libs/jquery/2.2.3/jquery.min.js",function(){z(jQuery)}):z(jQuery)}var w={url:"https://cdn-spurit.com/all-apps/selector-picker-4.x.js",cmd:"sign=spurit_ssp"};
Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(a,c){if(void 0===a||null===a)throw new TypeError("Cannot convert first argument to object");for(var b=Object(a),e=1;e<arguments.length;e++){var f=arguments[e];if(void 0!==f&&null!==f)for(var h=Object.keys(Object(f)),g=0,l=h.length;g<l;g++){var n=h[g],q=Object.getOwnPropertyDescriptor(f,n);void 0!==q&&q.enumerable&&(b[n]=f[n])}}return b}});var a={config:{frontMainFolder:"shopify-apps",backendFolder:"split-partial-payments",
prefix:"SSP",storagePrefix:"//cdn-spurit.com/"}};a.backendUrl="//shopify-apps.spur-i-t.com/"+a.config.backendFolder+"/";"undefined"!==typeof SSPParams&&"test"===SSPParams.server&&(a.config.frontMainFolder+="-test",a.config.backendFolder="split-payments",a.backendUrl="//testing.shopify-apps.spur-i-t.com/"+a.config.backendFolder+"/");var p;a.config.storagePrefix+=a.config.frontMainFolder+"/split-payments";a.orderCreated=!1;a.waitingForAJAX=!1;a.created=[];a.index=0;a.init=function(b,c){c=c||!1;var d=
b("head");d.append('<link rel="stylesheet" href="'+a.config.storagePrefix+'/tooltipster.css" type="text/css" />');d.append('<link rel="stylesheet" href="'+a.config.storagePrefix+'/common.css" type="text/css" />');d.append('<link rel="stylesheet" href="'+a.config.storagePrefix+"/store/"+SSPParams.id+".css?"+Math.random()+'" type="text/css" />');r(a.config.storagePrefix+"/store/"+SSPParams.id+".js?"+Math.random(),function(){Object.assign(a.config,SSPParams,SSPConfig);c&&r(a.config.storagePrefix+"/jquery.tooltipster.min.js",
function(){a.run(b)},"js",!0);var e=v("ssp_checkout_id"),f=v("ssp_invoice_ids");e&&f&&a.showCheckoutReminder(e,f)})};a.showCheckoutReminder=function(b,c){a.reminder=new C(b,c);a.reminder.show()};a.getConfig=function(a,c){return a?c?"undefined"!=typeof this.config[a][c]?this.config[a][c]:null:"undefined"!=typeof this.config[a]?this.config[a]:null:this.config};a.getCustom=function(a){if("undefined"!==typeof SSPCustom)return"undefined"!=typeof SSPCustom[a]?SSPCustom[a]:null};a.run=function(){if(+a.getConfig("split")||
+a.getConfig("share")){a.textData=a.getConfig("txt");var b=a.getConfig("selector");this.button=new D;if(null==b)throw Error("Error. Empty button selector.");var c=document.querySelector(b);if(c)this.button.show(c,a.getConfig("position"));else{var d=this,e=a.getCustom("buttonTimeout")||1E3;setTimeout(function(){c=document.querySelector(b);if(!c)throw Error("Error. There is no element with selector "+b);d.button.show(c,a.getConfig("position"))},e)}}};a.waitData=function(b,c,d,e){e=e||"waitingForAJAX";
var f=setInterval(function(){if(!a[e])return clearInterval(f),b.apply(c,d)},50)};a.getCartTotal=function(){return p.getDiscountedTotal()};a.createOrdersNew=function(b){a.waitingForAJAX=!0;var c=[],d=function(){clearTimeout(h);p.removeDiscount();Spurit.global.checkout.setTags("",t);Spurit.global.checkout.setNote("",t)},e=function(){d();a.orderCreated=!0;if("split"===b.SplitOrder.type){a.setOrderCookies(c,172800);var e=a.getCheckoutLinksHTML(c,"split");a.button.getTarget().changeState("custom",e)}else parseFloat($(".ssp-content.active").find('[name="main-sum"]').val())?
(e=c.length-1,a.setOrderCookies([c[e]],1209600),a.goToCheckout(c[e].draft_order.invoice_url)):(a.setOrderCookies([c[0]],1209600),e=a.getCheckoutLinksHTML(c,"share"),a.button.getTarget().changeState("custom",e));"undefined"!=typeof a.reminder&&a.reminder.destroy()},f=function(){d();a.waitingForAJAX=!1;a.index=0;a.showDraftOrderError(c)};var h=setTimeout(function(){c.length===b.SplitOrder.amounts.length?a.saveOrders(c,b,e,f):f()},12500);var g=a.getConfig(b.SplitOrder.type+"_tag")||a.getConfig("default_"+
b.SplitOrder.type+"_tag");Spurit.global.checkout.setTags(g,t);Spurit.global.checkout.setNote(a.getConfig("note"),t);var l=a.getDraftOrderDiscounts(b),n=function(){if(0!==l.length){var d=l.length-1,g=l.pop();"fixed"===a.getDiscountType()?p.addFixedDiscount(g):p.addPercentDiscount(g);if("undefined"!==typeof b.SplitOrder.emails)var B=b.SplitOrder.emails[d];else"undefined"!==typeof b.SplitOrder.email&&(B=b.SplitOrder.email);Spurit.global.checkout.createDraftorder(function(m){m?(c.push(m),n()):f();c.length===
b.SplitOrder.amounts.length&&a.saveOrders(c,b,e,f)},B,a.needsShipping&&0<d?{custom:!0,title:"Free Shipping",price:0}:null)}};n()};a.getDiscountType=function(){return Spurit.global.prices.isCurrentCurrencyEqualShopCurrency()?"fixed":"percent"};a.getDraftOrderDiscounts=function(b){return"fixed"===a.getDiscountType()?a.calcFixedDiscounts(b):a.calcPercentDiscounts(b)};a.calcFixedDiscounts=function(b){var c=a.getCartTotal();return b.SplitOrder.amounts.map(function(a){return c-a})};a.calcPercentDiscounts=
function(b){for(var c=[],d=a.getCartTotal(),e=0,f=0;f<b.SplitOrder.amounts.length-1;f++){var h=Math.round((d-b.SplitOrder.amounts[f])/d*1E3)/10;c.push(h);e+=100-h}c.push(Math.floor(10*e)/10);return c};a.updateLoading=function(a){var b=loadingMessage.getElementsByTagName("SPAN"),d=1<a?"payments":"payment";b.length?b[0].innerHTML=a+" "+d+" created":(b=document.createElement("SPAN"),b.innerHTML=a+" "+d+" created",loadingMessage.appendChild(b))};a.checkOrderTotal=function(b){var c=a.getCartTotal();if(null===
c)return!1;for(var d=0,e=0;e<b.SplitOrder.amounts.length;e++)d+=100*b.SplitOrder.amounts[e];return Math.round(100*c)===Math.round(d)};a.getOrderTargets=function(){var b=[];if("undefined"!=typeof a.cartData)for(var c=0;c<a.cartData.items.length;c++){var d=a.cartData.items[c];b.push({vid:d.variant_id,qty:d.quantity})}return b};a.showDraftOrderError=function(b){alert("An error occured while creating the order. Please try again later or contact the store owner.");a.deleteDrafts(b);a.button.getTarget().changeState("loaded")};
a.deleteDrafts=function(a){for(var b=0;b<a.length;b++)Spurit.global.checkout.deleteDraftorder(a[b].draft_order.id)};a.saveOrders=function(b,c,d,e){c.drafts=[];var f=c.SplitOrder,h=f.amounts.length;f.emails&&(h=f.emails.length);for(var g=0;g<h;g++){var l=this.findDraftOrder(b,f.emails?f.emails[g]||null:null,f.amounts[g]);if(!l){e();return}c.drafts.push(this.makeDraftForBackend(l));b=b.filter(function(a){return a.draft_order.id!==l.id})}$.ajax(a.backendUrl+"ajax_split_orders/create/?id="+a.getConfig("id"),
{type:"POST",method:"POST",data:JSON.stringify(c),contentType:"application/json",success:function(a){d()},error:function(a){e()}})};a.findDraftOrder=function(a,c,d){var b=null;null===c&&(b=a.find(function(a){return null===a.draft_order.shipping_line}));b||(b=a.find(function(a){return a.draft_order.email===c}));b||(b=a.find(function(a){return+a.draft_order.subtotal_price===d}));return b?b.draft_order:null};a.makeDraftForBackend=function(a){return{draft_order:{id:a.id,name:a.name,invoice_url:a.invoice_url}}};
a.goToCheckout=function(b){a.button.getTarget().changeState("redirecting");window.location.href=b};a.setOrderCookies=function(a,c){var b=[];u("ssp_checkout_id",a[0].draft_order.invoice_url.split("/")[3],{expires:c});for(var e=0;e<a.length;e++)b.push(a[e].draft_order.invoice_url.split("/")[5]);u("ssp_invoice_ids",b.join("/"),{expires:c})};a.getCheckoutLinksHTML=function(a,c){if("split"===c){var b="Your split order was successfully created. Checkout links:<br/><ul>\x3c!--";for(var e=0;e<a.length;e++)b+=
'--\x3e<li><a href="'+a[e].draft_order.invoice_url+'" target="_blank">'+a[e].draft_order.name+"</a></li>\x3c!--"}else for(b="Your split order was successfully created. Invoices was been sent to the following emails:<br/><ul>\x3c!--",e=0;e<a.length;e++)a[e].draft_order.email&&(b+="--\x3e<li><span>"+a[e].draft_order.email+"</span></li>\x3c!--");return b+"--\x3e</ul>"};a.requiresShipping=function(){if("undefined"==typeof a.cartData)return a.needsShipping=!0;for(var b=0;b<a.cartData.items.length;b++)if(a.cartData.items[b].requires_shipping)return a.needsShipping=
!0;return a.needsShipping=!1};var C=function(b,c){var d=this;this.positionParams={bottom:{reminder:{bottom:0},icon:{"vertical-align":"bottom"}},top:{reminder:{top:0},icon:{"vertical-align":"top"}},left:{reminder:{"text-align":"left"}},right:{reminder:{"text-align":"right"}}};this.state="closed";this.visible=!1;this.init=function(){this.urls=[];for(var e=c.split("/"),f=0;f<e.length;f++)this.urls.push(window.location.origin+"/"+b+"/invoices/"+e[f]);this.DOMElem=document.createElement("div");this.DOMElem.id=
"SSPReminder";e=document.createElement("div");e.id="SSPReminderHeader";e.innerHTML=a.getConfig("txt","reminder_icon");var d=document.createElement("div");d.id="SSPReminderContent";var g="Your Split Payment List:<ul>";for(f=0;f<this.urls.length;f++)g+='<li><a href="'+this.urls[f]+'" target="_blank">Payment '+(f+1)+"</a></li>";d.innerHTML=g+'</ul><div id="SSPForgotBtn" class="ssp-btn">Clear My Payments</div>';this.DOMElem=this.build(this.DOMElem,e,d,a.getConfig("txt","badge_position").split("_")[0],
a.getConfig("txt","badge_position").split("_")[1])};this.show=function(){document.body.appendChild(this.DOMElem);this.visible=!0;SSPReminderHeader.onclick=function(){$(SSPReminderContent).toggle(100)};SSPForgotBtn.onclick=function(){if(confirm("Are you sure that you want to disable this reminder popup. If you haven't paid this orders, make sure that you have access to their checkouts.")){d.destroy();for(var a=["ssp_checkout_id","ssp_invoice_ids"],b=0;b<a.length;b++)u(a[b],"",{expires:-1})}return!1}};
this.destroy=function(){this.visible&&(document.body.removeChild(this.DOMElem),this.visible=!1)};this.build=function(a,b,c,d,l){a=a.cloneNode(!1);"left"===l?(a.appendChild(b),a.appendChild(c)):(a.appendChild(c),a.appendChild(b));a.style.bottom=a.style.top="auto";c.style.display="none";for(var e in this.positionParams[d].reminder)a.style[e]=this.positionParams[d].reminder[e];for(e in this.positionParams[l].reminder)a.style[e]=this.positionParams[l].reminder[e];for(e in this.positionParams[d].icon)b.style[e]=
this.positionParams[d].icon[e];return a};this.init()},D=function(){var b=document.createElement("button");b.id="split-payment";b.className="tooltipstered";b.innerHTML=a.textData.btn_text;b.setAttribute("title",a.textData.descr_text);var c=new E;this.getTarget=function(){return c};this.show=function(c,e){"before"==e?$(c).before(b):$(c).after(b);+a.getConfig("copy_styles")&&this.copyStyles(c);this.addListeners();var d=a.textData.descr_mode;if("disabled"!=d){var h="fixed"==d?"custom":"hover";$(b).tooltipster({trigger:h,
position:a.textData.descr_position});"fixed"==d&&setTimeout(function(){$(b).tooltipster("show")},1E3)}};this.addListeners=function(){b.onclick=function(){c.show();return!1}};this.copyStyles=function(a){var c=["height","marginBottom","marginTop","verticalAlign","lineHeight"];a=getComputedStyle(a);for(var d=0;d<c.length;d++)b.style[c[d]]=a[c[d]];b.style.paddingBottom="0";b.style.paddingTop="0"}},E=function(){var b=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,
document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight),c,d,e,f,h,g,l,n,q,k=this;this.placed=!1;this.init=function(){c=document.createElement("div");c.className="ssp-screen";c.id="darkScreen";c.style.display="none";c.style.opacity="0";d=document.createElement("div");d.className="ssp-popup";d.id="SSPPopup";d.style.display="none";d.style.opacity="0";e=document.createElement("div");e.id="loadingMessage";e.className="ssp-background-message";e.innerHTML=
"<h3>Please Wait...</h3>";e.style.visibility="visible";e.style.opacity="1";d.appendChild(e);q=document.createElement("div");q.className="ssp-popup-heading";q.innerHTML="<h2>"+a.textData.title_text+'</h2><span class="ico close-popup">&times;</span>';d.appendChild(q);f=document.createElement("div");f.id="SSPContainer";f.style.visibility="hidden";f.style.opacity="0";d.appendChild(f);var b=[];b[0]=+a.getConfig("split")?" active":"";b[1]=+a.getConfig("split")?"":" active";n=document.createElement("div");
n.className="ssp-tabs";var m="";+a.getConfig("split")&&(m+='<div class="ssp-tab-item'+b[0]+'"><strong>Multiple Payment</strong></div>');+a.getConfig("share")&&(m+='<div class="ssp-tab-item'+b[1]+'"><strong>Share Payment</strong></div>');n.innerHTML=m;+a.getConfig("split")&&+a.getConfig("share")||(n.children[0].style="width: 100%; margin -right: 0;");f.appendChild(n);+a.getConfig("split")&&(h=document.createElement("div"),h.id="SSPSplit",h.className="ssp-content"," active"!==b[0]&&(h.style.display=
"none"),m=""+a.textData.split_first_description+'<hr><div id="splitFieldset0" class="ssp-fieldset"><label needs="renumber" class="ssp-inline">1st payment:</label><div class="ssp-prefix">'+Spurit.globalSnippet.cart.currency+'</div><input type="number" name="sum[0]" class="ssp-prefixed" step="0.01"></div><div id="splitFieldset1" class="ssp-fieldset"><label needs="renumber" class="ssp-inline">2nd payment:</label><div class="ssp-prefix">'+Spurit.globalSnippet.cart.currency+'</div><input type="number" name="sum[1]" class="ssp-prefixed" step="0.01"></div><a id="addPaymentLink" class="ssp-link">Add new payment</a><div id="SplitSubtotal" class="subtotal-container"><div class="ssp-prices"><strong>Subtotal</strong> <span class="ssp-current-total"><span class="ssp-currency">'+
Spurit.globalSnippet.cart.currency+'</span> <span class="ssp-price"></span></span> / <span class="ssp-cart-total"><span class="ssp-currency">'+Spurit.globalSnippet.cart.currency+'</span> <span class="ssp-price"></span></span></div></div>'+a.textData.split_second_description,h.innerHTML+=m,f.appendChild(h));+a.getConfig("share")&&(g=document.createElement("div"),g.id="SSPShare",g.className="ssp-content"," active"===b[0]&&(g.style.display="none"),b="",m=' style="margin-bottom: 20px;"',+a.getConfig("allow_only_recipients")&&
(m=' class="ssp-with-description"',b='<div class="ssp-small-descr">Optional</div>'),m=""+a.textData.share_first_description+"<hr><div"+m+'><label class="ssp-inline ssp-smaller">I will pay:</label><div class="ssp-input-container"><div class="ssp-prefix">'+Spurit.globalSnippet.cart.currency+'</div><input type="number" name="main-sum" class="ssp-prefixed" step="0.01">'+b+'</div>\x3c!----\x3e<span class="ssp-info-badge">Pays for Shipping</span></div><div id="shareFieldset0" class="ssp-fieldset"><div class="ssp-input-container"  style="margin-right: 20px;"><label>My recipient will pay:</label><div class="ssp-prefix">'+
Spurit.globalSnippet.cart.currency+'</div><input type="number" name="amount[0]" class="ssp-prefixed" step="0.01"></div><div class="ssp-input-container"><label>Recipient E-mail:</label><input type="email" name="email[0]"></div>\x3c!----\x3e<span class="ssp-info-badge">Free Shipping</span></div><a id="addRecipientLink" class="ssp-link">Add new payment</a><div id="ShareSubtotal" class="subtotal-container"><div class="ssp-prices"><strong>Subtotal</strong> <span class="ssp-current-total"><span class="ssp-currency">'+
Spurit.globalSnippet.cart.currency+'</span> <span class="ssp-price"></span></span> / <span class="ssp-cart-total"><span class="ssp-currency">'+Spurit.globalSnippet.cart.currency+'</span> <span class="ssp-price"></span></span></div></div>'+a.textData.share_second_description,g.innerHTML+=m,f.appendChild(g));l=document.createElement("div");l.className="ssp-bottom-actions";l.innerHTML='<button class="ssp-btn ssp-clean" action="cancel">Cancel</button><button class="ssp-btn ssp-primary" action="save">Save</button>';
f.appendChild(l)};this.getDelLink=function(){var a=document.createElement("a");a.className="ssp-link ssp-del-link";a.setAttribute("action","delete");a.innerHTML="Delete";return a};this.addDelListener=function(a){a.onclick=function(){var b=$(a).parents(".ssp-content");k.deleteCondition(this);k.updateSubtotal(null,b);return!1}};this.show=function(){this.placed||(document.body.appendChild(c),document.body.appendChild(d),$(".ssp-content.active").length||$(".ssp-content").first().addClass("active"),$('.close-popup, [action="cancel"]').on("click",
function(){k.hide()}),this.addInputControl($(d).find("input")),$("#addPaymentLink").on("click",function(){var b=$(this).prev(),c=b.clone(!1,!0),d=+b.attr("id").slice(13)+1,e=b.parent().children("div.ssp-fieldset").length+1;if(e>a.getConfig("maxConditions"))return alert("Max count of methods/payers: "+a.getConfig("maxConditions")),!1;var f=3==e?"d":"th",g=c.find('[name*="sum"]'),h=g.prev().prev();g.val("").attr("name","sum["+d+"]");h.html(e+f+" payment:");c.attr("id","splitFieldset"+d);if(2==d){var l=
k.getDelLink();c.append(l)}"undefined"===typeof l&&(l=c.get(0).getElementsByTagName("a")[0]);k.addDelListener(l);b.after(c);k.addInputControl($(c).find('input[type="number"]'))}),$("#addRecipientLink").on("click",function(){var b=$(this).prev(),c=b.clone(!1,!0);c.find(".ssp-info-badge").html("Free Shipping");var d=+b.attr("id").slice(13)+1;if(d>a.getConfig("maxConditions")-2)return alert("Max count of methods/payers: "+a.getConfig("maxConditions")),!1;var e=c.find('[name*="amount"]'),f=c.find('[name*="email"]');
e.val("").attr("name","amount["+d+"]");f.val("").attr("name","email["+d+"]");c.attr("id","shareFieldset"+d);if(1==d){var g=k.getDelLink();c.append(g)}"undefined"===typeof g&&(g=c.get(0).getElementsByTagName("a")[0]);k.addDelListener(g);b.after(c);k.addInputControl($(c).find("input"))}),$(".ssp-tab-item").on("click",function(){if($(this).hasClass("active"))return!1;this.className+=" active";$(this).siblings(".active").removeClass("active");var a=$(".ssp-content"),b=a.filter(".active");b.removeClass("active").css("display",
"none");a.not(b).addClass("active").css("display","block")}),$('[action="save"]').on("click",function(){if(a.orderCreated)alert("The order was already created.");else if(!v("ssp_checkout_id")||confirm("You have already create some split order earlier. If you don't pay them, make sure that you have access to their checkouts.")){k.changeState("loading");var b="",c=k.getOrderData();"string"==typeof c?b=c:a.checkOrderTotal(c)||(b="The sum of the payments must be equal to the cart total.");b?(alert(b),
k.changeState("loaded")):a.createOrdersNew(c)}}),this.placed=!0);c.style.display=d.style.display="block";c.style.height=b+"px";$(c).animate({opacity:.5});$(d).animate({opacity:1},{complete:function(){a.waitingForAJAX=!1;a.cartData={items:p.getItems()};a.waitData(function(){k.setInitPrices();k.updateShippingBadge()},k);k.changeState("loaded")}})};this.addInputControl=function(b){b.on("change",function(){"number"===this.getAttribute("type")?(this.value=this.value.replace("-",""),""===this.value?"main-sum"!=
this.name||"0"==a.getConfig("allow_only_recipients")?this.style.borderColor="red":(k.updateShippingBadge("recipient"),k.updateSubtotal(this)):(this.style.borderColor="inherit",k.updateSubtotal(this),"main-sum"==this.name&&k.updateShippingBadge("initiator"))):x(this.value)?this.style.borderColor="inherit":this.style.borderColor="red"})};this.updateShippingBadge=function(b){var c=document.getElementsByClassName("ssp-info-badge");c.length&&(!a.needsShipping||a.getCustom("hideShippingBadges")?$(c).css("display",
"none"):(b||(b=""==$(".main-sum").val()?"recipient":"initiator"),"initiator"===b?(c[0].style.display="",c[1].innerHTML="Free Shipping"):(c[0].style.display="none",c[1].innerHTML="Pays for Shipping")))};this.updateSubtotal=function(a,b){b=b||$(a).parents(".ssp-content");var c="#888",d=b.find('input[type="number"]'),e=b.find(".ssp-prices").find(".ssp-current-total"),f=b.find(".ssp-prices").find(".ssp-cart-total");f=y(f.find(".ssp-price").html().replace(",",""),2);var m=0;d.each(function(a,b){isNaN(b.value)||
(m+=+b.value)});m=y(m,2);e.children(".ssp-price").html(this.getTotalHTML(m));m>=f&&(c=m===f?"green":"red");e.css("color",c)};this.getTotalHTML=function(a){for(var b=(""+Math.floor(a)).split("").reverse().join("").match(/.{1,3}/g),c=0;c<b.length;c++)b[c]=b[c].split("").reverse().join("");b=b.reverse().join(",");a=(""+a).split(".");a[1]&&(b+="."+a[1]);return b};this.hide=function(){this.placed&&($(c).animate({opacity:0},{complete:function(){c.style.display="none"}}),$(d).animate({opacity:0},{complete:function(){d.style.display=
"none";k.changeState("loading")}}))};this.setInitPrices=function(){a.cartData.items.length||(alert("Something went wrong. Please re-add your products to the cart."),k.hide());a.requiresShipping()&&k.updateShippingBadge();var b=document.querySelectorAll("#SSPSplit input"),c=document.querySelectorAll('#SSPShare input[type="number"]');if(2===b.length||2===c.length){var d=a.getCartTotal(),e=this.getTotalHTML(d);2===b.length&&(this.fillInputs(b,d/2),$("#SplitSubtotal .ssp-cart-total .ssp-price").html(e),
this.updateSubtotal(b[0]));2===c.length&&(this.fillInputs(c,d/2),$("#ShareSubtotal .ssp-cart-total .ssp-price").html(e),this.updateSubtotal(c[0]))}};this.fillInputs=function(a,b){for(var c=!0,d=0;d<a.length;d++)if(""!=a[d].value){c=!1;break}c&&(0!=1E3*b%10?(a[0].value=(1E3*b+5)/1E3,a[1].value=(1E3*b-5)/1E3):a[0].value=a[1].value=b)};this.deleteCondition=function(a){var b=a.parentElement.parentElement;b.removeChild(a.parentElement);"SSPSplit"===b.id&&k.renumberLabels(SSPSplit)};this.renumberLabels=
function(a){$(a).find('[needs="renumber"]').each(function(a){if(1<a){var b=2==a?"d":"th";$(this).html(a+1+b+" payment")}})};this.getOrderData=function(){var b={SplitOrder:{amounts:[]},requiresShipping:a.needsShipping},c=!1,d=$(".ssp-content.active"),e=a.getConfig("customer_email")||"";if("SSPSplit"===d.attr("id"))b.SplitOrder.type="split",e&&(b.SplitOrder.email=e),d.find("input").each(function(a,d){var e=+$(d).val();isNaN(e)||0>=e?c="Invalid payment sum.":b.SplitOrder.amounts.push(e)});else{b.SplitOrder.type=
"share";b.SplitOrder.emails=[];var f=+d.find('[name="main-sum"]').val();0<f&&!c&&(b.SplitOrder.emails.push(e),b.SplitOrder.amounts.push(f));if(0>f||0==f&&!+a.getConfig("allow_only_recipients")||isNaN(f))c="Invalid payment sum.";0==f&&(b.SplitOrder.only_recipients=!0);d.find(".ssp-fieldset").each(function(a,d){var e=$(d).find("input");if(isNaN(e.first().val())||0>=+e.first().val())c="Invalid payment sum.";c||b.SplitOrder.amounts.push(+e.first().val());""==e.last().val()&&(c="All email field must be not empty.");
x(e.last().val())||(e.last().css("border-color","red"),c="Invalid email");c||b.SplitOrder.emails.push(e.last().val())})}return c||(b.Target=a.getOrderTargets(),b.Target.length)?c||b:"The order must include at least one item."};this.changeState=function(a,b){b=b||"";switch(a){case "loading":e.innerHTML="<h3>Please Wait...</h3>";f.style.visibility="hidden";$(f).animate({opacity:0});$(e).animate({opacity:1});e.style.visibility="visible";break;case "loaded":f.style.visibility="visible";$(f).animate({opacity:1},
function(){});$(e).animate({opacity:0});e.style.visibility="hidden";break;case "redirecting":e.innerHTML="<h3>Redirecting to checkout...</h3>";f.style.visibility="hidden";$(f).animate({opacity:0});$(e).animate({opacity:1});e.style.visibility="visible";break;case "custom":e.innerHTML=b,$(f).animate({opacity:0}),$(e).animate({opacity:1}),e.style.visibility="visible"}};this.init()},t="split_payments";"undefined"===typeof Spurit.global?r("https://cdn-spurit.com/all-apps/spurit.global-2.x.min.js",A,"js"):
A()})();
